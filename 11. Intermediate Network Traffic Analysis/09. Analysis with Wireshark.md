---
title: 09. Analysis with Wireshark
updated: 2025-09-13 18:36:00Z
created: 2025-09-09 05:11:31Z
---

## Wireshark vs. TShark vs. Termshark

| Tool | Interface | Best Use Case |
| --- | --- | --- |
| **Wireshark** | GUI | Full-featured, visual packet analysis |
| **TShark** | CLI | Scripted use, servers without GUI |
| **Termshark** | TUI | Wireshark-like experience inside terminal |

### TShark Basics

TShark is Wireshark’s CLI version. It supports the same syntax and filters, making it great for headless servers.

Common switches:

| Switch | Description |
| --- | --- |
| `-D` | List interfaces and exit |
| `-L` | List link-layer mediums |
| `-i` | Select interface (e.g., `-i eth0`) |
| `-f` | Apply capture filter (BPF syntax) |
| `-c` | Capture specific number of packets |
| `-a` | Set auto-stop condition |
| `-r` | Read from file |
| `-w` | Write to file (PCAPNG format) |
| `-P` | Print summaries while writing |
| `-x` | Show Hex/ASCII output |
| `-h` | Help menu |

Examples:

```
# Capture on interface eth0, save to file
sudo tshark -i eth0 -w /tmp/test.pcap

# Capture traffic only from host 172.16.146.2
sudo tshark -i eth0 -f "host 172.16.146.2"

# Read packets from a saved capture
tshark -r /tmp/test.pcap

```

### Termshark

- Provides a **text-based interface** similar to Wireshark, directly in terminal.
    
- Download from [GitHub releases](https://github.com/gcla/termshark/releases)
    
- .
    
- Use similar syntax as TShark:
    

`termshark -i eth0`

* * *

&nbsp;

## Filters in Wireshark

### Capture Filters (before capture starts)

- Syntax: **BPF** (same as `tcpdump`).
    
- Used to reduce data written to disk.
    

| Filter | Description |
| --- | --- |
| `host 10.0.0.1` | Capture only traffic involving that host |
| `net 192.168.1.0/24` | Capture traffic in a subnet |
| `src host 10.0.0.5` | Only packets sourced from IP |
| `port 80` | Only traffic on TCP/UDP port 80 |
| `not port 22` | Capture everything except SSH traffic |
| `portrange 20-25` | Capture traffic in a port range |

Apply via **Capture Options → Capture Filter**.

* * *

### Display Filters (during/after capture)

- Syntax: **Wireshark’s own filter language**.
    
- Allows surgical packet analysis without discarding data.
    

| Filter | Description |
| --- | --- |
| `ip.addr == 10.0.0.1` | Packets involving host |
| `ip.src == 192.168.1.10` | Source IP only |
| `tcp.port == 443` | Traffic on TCP port 443 |
| `dns` | DNS packets |
| `http.request.method == "GET"` | Filter HTTP GET requests |

Green bar = valid filter, red = invalid.

* * *

## Saving & Managing Captures

- Save via **File → Save** or toolbar.
    
- Default format: `.pcap` or `.pcapng`.
    
- For large captures, break into smaller chunks before applying filters (Wireshark can lag with very large files).
    

* * *

## Summary

- **Wireshark GUI** = rich visualization.
    
- **TShark** = command-line version, scripting-friendly.
    
- **Termshark** = Wireshark feel inside terminal.
    
- **Filters** = capture (pre-capture, BPF) vs display (post-capture, Wireshark syntax).
    
- **Best practice** = filter early to save disk space, filter later to analyze deeply.
    

* * *

&nbsp;

# Wireshark Advanced Usage

Wireshark isn’t just a packet sniffer—it’s a **full analysis suite**. Beyond simple captures, it can reconstruct conversations, extract files, detect issues, and even help crack credentials. Many of these features are accessible through its **Analyze** and **Statistics** menus, which act as gateways to powerful built-in plugins.

* * *

## 1\. Analyze & Statistics Tabs

The **Statistics** and **Analyze** menus provide deep insights into captured traffic:

- **Statistics tab**:
    
    - Protocol hierarchy (percentage of traffic by protocol).
        
    - Conversations (end-to-end communications between hosts).
        
    - Endpoints (all participating IPs and their activity).
        
    - “Top talkers” (who sends/receives the most traffic).
        
- **Analyze tab**:
    
    - Follow streams (TCP, UDP, HTTP, etc.).
        
    - Apply or prepare filters.
        
    - Enable/disable protocol decoders.
        
    - Expert Information (flags unusual or suspicious events).
        

Together, these menus let you move from **big-picture summaries** down to **fine-grained packet-level inspection**.

* * *

## 2\. Following TCP Streams

One of Wireshark’s most practical features is the ability to **reassemble TCP conversations** into a human-readable flow. This lets you view entire chats, HTTP requests/responses, or even extract transferred data.

**Steps (GUI):**

1.  Right-click a packet from the conversation.
    
2.  Select **Follow → TCP Stream**.
    
3.  A new window opens with the full conversation.
    

**Command-line alternative:**  
Apply a stream filter directly: `tcp.stream eq 3`

This isolates all packets from stream #3, showing the handshake and subsequent data transfer in order.

* * *

## 3\. Extracting Files & Data from Captures

Wireshark can **rebuild transferred files** if the entire session is captured. This works with multiple protocols (HTTP, FTP, SMB, DICOM, etc.).

**Steps to extract files:**

1.  Stop the capture.
    
2.  Go to **File → Export Objects**.
    
3.  Choose the relevant protocol (e.g., HTTP, SMB).
    
4.  Select and save the reconstructed file(s).
    

Note: If the capture is incomplete, Wireshark may fail to rebuild the file.

* * *

## 4\. FTP Analysis in Wireshark

FTP is a common protocol to demonstrate file reconstruction because it uses **two channels**:

- **Port 21** → Control (logins, commands).
    
- **Port 20** → Data (actual file transfers).
    

Wireshark provides specific filters for FTP traffic:

| Filter | Purpose |
| --- | --- |
| `ftp` | Shows all FTP traffic (control + data). |
| `ftp.request.command` | Displays commands (e.g., USER, PASS, LIST). Useful for spotting logins or file requests. |
| `ftp-data` | Shows raw file transfers over the data channel. |

* * *

**Workflow to reconstruct a file:**

1.  Filter for `ftp` to identify sessions.
    
2.  Use `ftp.request.command` to check filenames, login attempts, etc.
    
3.  Apply `ftp-data` to capture file transfers.
    
4.  Right-click the data packet → **Follow TCP Stream**.
    
5.  In the “Follow Stream” window, switch **“Show and save data as” → Raw**.
    
6.  Save the output with the correct filename and validate it.
    

This allows recovery of items like text files, images, or executables transferred over FTP.

* * *

## 5\. Practical Takeaways

- **Statistics tab** = Big picture (protocol breakdowns, conversations, top talkers).
    
- **Analyze tab** = Deep dives (filters, streams, expert info).
    
- **Follow Streams** = Reassemble human-readable conversations.
    
- **File Extraction** = Recover data (HTTP, FTP, SMB, etc.).
    
- **FTP Filters** = A powerful case study for pulling out credentials and files.
    

* * *

&nbsp;