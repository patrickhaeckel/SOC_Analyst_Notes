---
title: 25. Peculiar DNS Traffic
updated: 2025-09-20 02:09:03Z
created: 2025-09-20 02:04:19Z
---

# Peculiar DNS Traffic

## Why DNS Traffic Matters in Security Analysis

DNS (Domain Name System) is like the Internet’s phone book — it translates human-friendly domain names (like `example.com`) into IP addresses (like `93.184.216.34`). Every time a device connects to a new site, service, or server, it often generates DNS queries.  
Because DNS is so heavily used, attackers abuse it. **Abnormal DNS patterns can signal reconnaissance, malware communication, or data exfiltration**. The challenge: with thousands of queries in normal environments, unusual or malicious ones can be easy to miss.

* * *

## Forward DNS Lookups (Normal Queries)

A forward lookup is the standard DNS operation: resolving a **domain → IP address**.

### Example

- **Request:** “Where is `academy.patrickhaeckel.com`?”
    
- **Response:** “It’s at `192.168.10.6`.”
    

### Step-by-Step Flow

1.  **Query Initiation**  
    A user types a URL (`academy.patrickhaeckel.com`) into a browser. The system needs the IP.
    
2.  **Local Cache Check**  
    The client checks if it has resolved this name recently. If cached, no external query is needed.
    
3.  **Recursive Query to Resolver**  
    The client asks its configured DNS resolver (usually the company’s DNS server or ISP’s DNS).
    
4.  **Root Servers**  
    If the resolver doesn’t know, it starts at the root servers (13 logical root servers exist globally). These know only where to find **TLD servers**.
    
5.  **TLD Servers**  
    The resolver asks the `.com` TLD servers where to find `patrickhaeckel.com`.
    
6.  **Authoritative Domain Servers**  
    The resolver then queries the authoritative servers for `patrickhaeckel.com` itself.
    
7.  **Final Answer**  
    The authoritative server responds with the IP address for `academy.patrickhaeckel.com`.
    
8.  **Response to Client**  
    The DNS resolver sends the IP to the original client.
    

* * *

## Reverse DNS Lookups

Reverse lookups do the opposite: **IP → domain**. They answer the question “what is the hostname for this IP?”

### Example

- **Request:** “What’s the name of `192.168.10.6`?”
    
- **Response:** “That’s `academy.patrickhaeckel.com`.”
    

### Steps

1.  **Client Query**  
    Client sends reverse DNS query for `192.168.10.6`.
    
2.  **Resolver Checks Reverse Zone**  
    Reverse zones use a special naming format (in-addr.arpa). For example, `192.168.10.6` would map to `6.10.168.192.in-addr.arpa`.
    
3.  **PTR Record Lookup**  
    The resolver looks for a **PTR (Pointer) record** that matches.
    
4.  **Response**  
    If found, the FQDN (fully qualified domain name) is returned.
    

* * *

## Common DNS Record Types

- **A** — Domain → IPv4 address.
    
- **AAAA** — Domain → IPv6 address.
    
- **CNAME** — Alias mapping (e.g., `hello.com` → `world.com`).
    
- **MX** — Mail server responsible for handling email for the domain.
    
- **NS** — Authoritative name servers for the domain.
    
- **PTR** — IP → Domain (reverse lookups).
    
- **TXT** — Arbitrary text (often abused for tunneling or SPF/DKIM email records).
    
- **SOA** — Start of Authority; administrative info about a DNS zone.
    

* * *

## DNS Enumeration (Reconnaissance Behavior)

Attackers often **enumerate domains and subdomains** during reconnaissance.  
In network captures:

- You may see **a high volume of DNS queries from one host**, often walking through possible subdomains.
    
- Attackers sometimes end with an **ANY query**, which requests *all available records* for a domain — a suspicious action in normal user traffic.
    

This is often a precursor to attacks like phishing, domain hijacking, or discovering hidden services.

* * *

## DNS Tunneling (Data Exfiltration or C2)

More advanced abuse is **DNS tunneling**, where attackers smuggle data through DNS queries/responses.

### How It Works

- Attackers encode chunks of data (credentials, file contents, or commands).
    
- They embed it in the **domain name or TXT record** of DNS queries.
    
- Because DNS traffic is usually allowed through firewalls, this bypasses many controls.
    

### Indicators

- **Lots of TXT records** in traffic from a single host.
    
- **Unusual-looking queries** with long, random strings.
    
- **Base64 or encrypted blobs** in packet data.
    

### Example (Data Exfiltration)

- In Wireshark, instead of normal requests (`www.google.com`), you might see something like:
    
- `dGhpcyBpcyBlbmNvZGVkLmV4ZmlsdHJhdGUuY29t`
    
- Extracting this data and decoding (e.g., `base64 -d`) may reveal sensitive stolen content.
    
- Attackers often encode multiple times or even encrypt to hide meaning.
    

### Attacker Goals

1.  **Data Exfiltration** — Smuggle stolen files or credentials out.
    
2.  **Command & Control (C2)** — Malware receives instructions from attacker-controlled DNS domains.
    
3.  **Firewall Bypass** — Since DNS is often trusted, it sneaks past perimeter defenses.
    
4.  **DGAs (Domain Generation Algorithms)** — Malware generates thousands of domain names and queries them. Only the attacker knows which one is real, but the traffic still blends in with DNS.
    

* * *

## Advanced Example: IPFS + DNS Tunneling

Some attackers use **IPFS (InterPlanetary File System)**, a peer-to-peer storage system.

- They hide payloads or malware on IPFS.
    
- Victims’ machines query through DNS/HTTP to fetch content, often at domains like:
    
- `https://cloudflare-ipfs.com/ipfs/QmS6eyoGjENZTMxM7UdqBk6Z3U3TZPAVeJXdgp9VK4o1Sz`
    
- Since IPFS is distributed, detection and takedown are much harder.
    

* * *

## Key Takeaways

- **Normal DNS traffic is noisy**, so spotting malicious queries requires baselining.
    
- **Enumeration attempts** = lots of queries, ANY records, suspicious volume from one host.
    
- **Tunneling attempts** = repeated TXT records, long/encoded queries, unusual entropy in packet payloads.
    
- **Defense**:
    
    - Monitor DNS logs for anomalies.
        
    - Restrict external DNS resolution.
        
    - Use DNS firewalls/security solutions.
        
    - Decode suspicious payloads (Base64, hex, etc.) for analysis.
        

* * *

&nbsp;