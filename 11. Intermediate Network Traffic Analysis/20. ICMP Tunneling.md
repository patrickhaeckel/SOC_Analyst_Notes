---
title: 20. ICMP Tunneling
updated: 2025-09-17 04:01:19Z
created: 2025-09-17 03:46:06Z
---

# ICMP Tunneling Explained

## What is Tunneling?

Tunneling is a technique used by adversaries to encapsulate data inside a legitimate protocol in order to bypass network controls and exfiltrate information. Instead of sending data through obvious channels (like FTP or HTTP POST), attackers "hide" the payload inside something that defenders usually allow, such as DNS, HTTP(S), or even ICMP.

This allows:

- **Command-and-Control (C2) communication**: Attackers maintain control of a compromised host.
    
- **Data exfiltration**: Sensitive information is smuggled out.
    
- **Evasion of firewalls/IDS**: Since the traffic looks like a permitted protocol, it may pass unnoticed.
    

Common tunneling protocols: **SSH, HTTP/HTTPS, DNS, Proxy-based tunnels, and ICMP.**

* * *

## ICMP Refresher

ICMP (Internet Control Message Protocol) is normally used for diagnostic and error-reporting purposes:

- **Echo Request (Type 8)** and **Echo Reply (Type 0)** are used by the `ping` utility to test connectivity.
    
- A standard ICMP Echo Request/Reply typically carries a **small payload (~48 bytes)**.
    

Since ICMP is widely allowed in networks for troubleshooting, attackers abuse it to smuggle data by **placing malicious content inside the ICMP data field**.

* * *

## ICMP Tunneling in Practice

In ICMP tunneling, the attacker:

1.  Takes data to be exfiltrated (e.g., usernames, passwords, files).
    
2.  Embeds it in the **payload/data section** of ICMP Echo Request packets.
    
3.  The receiving server extracts the data and may respond with ICMP Echo Replies, possibly carrying additional payloads.
    

Visually:  
**Host A (compromised)** → sends `Echo Request` with hidden data → **Server (attacker-controlled)** → responds with `Echo Reply` (possibly containing instructions or confirmation).

* * *

## Detecting ICMP Tunneling

### 1\. Unusual Packet Sizes

- **Normal ICMP request**: ~48 bytes of payload.  
    Example:
    
- `Type: 8 (Echo Request) Sequence Number: 256 Data length: 48 bytes`
    
- **Suspicious ICMP request**: Large payloads, sometimes fragmented across multiple IP packets.  
    Example:
    
- `Type: 8 (Echo Request) Sequence Number: 0 Data length: 38,000 bytes`
    

Large payloads + fragmentation = **potential tunneling activity.**

* * *

### 2\. Payload Analysis

- **Cleartext tunneling**: Payload might literally contain usernames, passwords, or other sensitive strings.  
    Example from a hex dump:
    
- `Username: root; Password: rd123$`
    
- **Encoded tunneling**: More sophisticated attackers encode or encrypt data.  
    Example payload (base64):
    
- `VGhpcyBpcyBhIHNlY3VyZSBrZXk6IEtleTEyMzQ1Njc4OQo=`
    

This can be extracted from Wireshark and decoded:

`echo 'VGhpcyBpcyBhIHNlY3VyZSBrZXk6IEtleTEyMzQ1Njc4OQo=' | base64 -dThis is a secure key: Key12345678`

* * *

### 3\. Wireshark Techniques

- Apply display filter:
    
- `icmp`
    
    This isolates only ICMP traffic.
    
- Look for:
    
    - **Large payload sizes**.
        
    - **Repeated patterns or anomalies in data fields**.
        
    - **Fragmented ICMP packets**, which indicate oversized data.
        

* * *

## Indicators of ICMP Tunneling

- ICMP packets significantly larger than normal (`>100 bytes`, sometimes thousands).
    
- Fragmented ICMP traffic between the same two hosts.
    
- Non-random or patterned payloads (text strings, base64 blobs).
    
- Continuous ICMP traffic beyond normal "ping" behavior (high frequency, long duration).
    

* * *

## Preventing ICMP Tunneling

1.  **Block ICMP (strict)**: Disable ICMP Echo Requests/Replies if not operationally required. This stops tunneling but may interfere with troubleshooting.
    
2.  **Restrict ICMP (controlled)**: Allow only specific ICMP message types or limit to certain network segments.
    
3.  **Inspect ICMP payloads**: Deploy IDS/IPS rules to:
    
    - Detect abnormal ICMP sizes.
        
    - Flag repeated encoded or suspicious patterns.
        
    - Strip data fields where possible.
        
4.  **Monitor fragmentation**: Excessive ICMP fragmentation should be investigated.
    

* * *

**Key Takeaway**:  
ICMP tunneling works because ICMP is often trusted and ignored by security controls. By watching for unusual packet sizes, payload contents, and fragmentation, defenders can spot tunneling attempts. If ICMP is not essential, blocking or restricting it reduces the attack surface.

&nbsp;