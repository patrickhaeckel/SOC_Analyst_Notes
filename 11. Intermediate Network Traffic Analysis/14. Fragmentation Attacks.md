---
title: 14. Fragmentation Attacks
updated: 2025-09-13 22:12:34Z
created: 2025-09-13 20:42:27Z
---

## Fragmentation Attacks

When analyzing network anomalies, one of the first layers to investigate is the **IP layer**. This layer’s main job is to move packets from one host to another across networks, using **source** and **destination IP addresses**.

Normally, large packets may need to be split into smaller pieces (called **fragments**) so they can travel across networks with different maximum transmission unit (MTU) sizes. The receiving system then reassembles these fragments into the original packet.

Attackers exploit this process through **fragmentation attacks**, where they intentionally manipulate or craft fragmented packets to confuse firewalls, intrusion detection systems (IDS), or the target host itself.

* * *

## Why Fragmentation Matters for Attacks

- **Security blind spots**: Some firewalls or IDS tools may fail to reassemble fragments correctly. Attackers can slip malicious payloads past defenses by hiding them inside fragmented packets.
    
- **Evasion techniques**: Nmap, for example, can use fragmentation to split its probes into tiny pieces, making them harder to detect by security devices.
    
- **Denial-of-Service (DoS)**: By sending overlapping or malformed fragments, attackers can crash or overload a target system.
    

* * *

## Key IP Header Fields in Fragmentation

When analyzing a PCAP, pay attention to these fields in the **IP header**:

| Field | Purpose | Why It Matters in Fragmentation Attacks |
| --- | --- | --- |
| **Header Length** | Size of the IP header | Helps confirm if optional fields are present. Attackers may manipulate this for obfuscation. |
| **Total Length** | Full size of the IP packet (header + data) | If the packet seems unusually small/large, it might indicate crafted traffic. |
| **Fragment Offset** | Position of this fragment relative to the start of the original packet | Used to reassemble fragments in order. Attackers may set misleading or overlapping offsets. |
| **Flags (DF, MF)** | "Don’t Fragment" (DF) and "More Fragments" (MF) bits control fragmentation behavior | Manipulating these can help attackers bypass MTU checks or confuse packet reassembly. |
| **Source & Destination IPs** | Sender and receiver addresses | Used to track traffic paths. In attacks, often spoofed. |

&nbsp;

## Example in Practice (Nmap)

- The pcap file demonstrates how Nmap sends **fragmented packets** to slip past a firewall.
    
- Instead of sending a normal TCP probe in one piece, Nmap breaks it into multiple fragments.
    
- Some firewalls inspect only the first fragment and let the rest through, allowing the payload to reach the target unnoticed.
    

# Abuse of Fragmentation – Summary

## Legitimate Purpose

- **Fragmentation** is used to split large packets into smaller pieces (based on the **MTU**) so they can be transmitted across the network and reassembled by the destination.
    
- The **last fragment** is often smaller.
    
- Packets contain information that helps the destination host correctly reassemble them.
    

* * *

## How Attackers Abuse Fragmentation

1.  **IDS/IPS Evasion**
    
    - If intrusion detection/prevention systems don’t reassemble fragments, attackers can split malicious traffic (e.g., Nmap scans).
        
    - Destination host reassembles normally, but security devices may miss it.
        
2.  **Firewall Evasion**
    
    - Similar to IDS/IPS evasion.
        
    - If firewalls don’t reassemble fragments, attackers can slip traffic through.
        
3.  **Resource Exhaustion**
    
    - Attackers set very **small MTU values** (e.g., 10, 15, 20).
        
    - Security devices may fail to handle excessive fragment reassembly, leading to missed detections.
        
4.  **Denial of Service (DoS)**
    
    - Sending **oversized fragmented packets** (> 65,535 bytes) to old or vulnerable hosts.
        
    - The reassembly process can crash or destabilize the system, causing DoS.
        

* * *

## Defensive Best Practices

- **Delayed Reassembly**:
    
    - Firewalls/IDS/IPS should mimic the behavior of a destination host.
        
    - Wait for all fragments, reassemble them, and then perform inspection.
        
    - Prevents evasion.
        

* * *

## Indicators of Fragmentation Attacks

### 1\. Host Discovery Phase

- **ICMP echo requests/replies** (ping traffic) during early Nmap scans.
    
- DNS queries and fragmented entries may also appear.
    

### 2\. Fragmented Port Scans

- Example: `nmap -f 10 <host ip>`
- Forces fragmentation at size 10 bytes.
- Large numbers of fragmented packets from a single host can be a strong signal.

### 3\. Traffic Patterns

- **Signs of a fragmented scan**:
    
    - One host sending packets to **many ports**.
        
    - Destination replies with **RST flags** for closed ports.
        
    - SYN and ACK flags visible in fragmented packets.
        

### 4\. Wireshark Analysis

- If Wireshark isn’t reassembling packets, adjust **IPv4 reassembly settings** in preferences.
    
- Look for:
    
    - **Fragmented ICMP and TCP packets**.
        
    - SYN/RST/ACK responses indicating scanning.
        
    - Unusual fragmentation patterns (e.g., excessive tiny fragments).
        

* * *

**Key Takeaway**: Fragmentation is a normal networking process but is frequently abused for **evasion, resource exhaustion, or DoS**. Detecting it relies on **recognizing abnormal patterns** (tiny MTUs, many ports scanned, excessive fragments) and ensuring **security devices reassemble packets before inspection**.