---
title: 03. CheatSheet
updated: 2025-09-15 02:08:01Z
created: 2025-08-24 04:01:51Z
---

# Intrusion Detection with Splunk 

1.  List everything (big picture)

```
index="main" earliest=0
```

- **Does:** Returns all events in “main” for all time.
    
- **Use for:** Establishing scope/volume before narrowing.
    

2.  See available data shapes

```
index="main" | stats count by sourcetype
```

- **Does:** Counts events per sourcetype.
    
- **Use for:** Deciding which data sources to hunt first.
    

3.  Focus on Sysmon only

```
index="main" sourcetype="WinEventLog:Sysmon"
```

- **Does:** Shows only Sysmon events.
    
- **Use for:** Windows process/file/registry/network telemetry.
    

4.  Fuzzy string hunt (fast, but broad)

```
index="main" uniwaldo.local
```

- **Does:** Finds that string anywhere in any field.
    
- **Use for:** Quick pivot when you have a literal indicator.
    

5.  Wildcard around a term (slower)

```
index="main" *uniwaldo.local*
```

- **Does:** Matches term inside larger strings.
    
- **Use for:** When indicator may be embedded/concatenated.
    

6.  Target a specific field (faster)

```
index="main" ComputerName="*uniwaldo.local"
```

- **Does:** Matches only in ComputerName.
    
- **Use for:** Efficient, low-noise filtering by known field.
    

7.  Inventory Sysmon Event IDs

```
index="main" sourcetype="WinEventLog:Sysmon" | stats count by EventCode
```

- **Does:** Shows which Sysmon events you have (by ID).
    
- **Use for:** Picking high-signal events to hunt.
    

8.  Parent-child process map

```
index="main" sourcetype="WinEventLog:Sysmon" EventCode=1 | stats count by ParentImage, Image
```

- **Does:** Summarizes process creation trees.
    
- **Use for:** Spotting weird parents (e.g., notepad → powershell).
    

9.  Focus on likely bad children

```
index="main" sourcetype="WinEventLog:Sysmon" EventCode=1 (Image="*cmd.exe" OR Image="*powershell.exe") | stats count by ParentImage, Image
```

- **Does:** Limits to cmd/PowerShell spawns.
    
- **Use for:** Quickly surfaces suspicious process chains.
    

10. Drill into a specific weird chain

```
index="main" sourcetype="WinEventLog:Sysmon" EventCode=1 (Image="*cmd.exe" OR Image="*powershell.exe")
ParentImage="C:\\Windows\\System32\\notepad.exe"
```

- **Does:** Shows only events where notepad started cmd/PowerShell.
    
- **Use for:** Validate a likely injection/LOLBin scenario.
    

11. Pivot on a suspicious IP across all data

```
index="main" 10.0.0.229 | stats count by sourcetype
```

- **Does:** Finds that IP in any sourcetype.
    
- **Use for:** Cross-source scoping of an indicator.
    

12. Check Linux syslog for IP ownership

```
index="main" 10.0.0.229 sourcetype="linux:syslog"
```

- **Does:** Shows syslog entries referencing the IP.
    
- **Use for:** Identify host/interface the IP belongs to.
    

13. See what commands used that IP

```
index="main" 10.0.0.229 sourcetype="WinEventLog:sysmon" | stats count by CommandLine
```

- **Does:** Groups associated command lines.
    
- **Use for:** Spot downloads, PsExec, staging tools, etc.
    

14. Attribute commands to hosts

```
index="main" 10.0.0.229 sourcetype="WinEventLog:sysmon" | stats count by CommandLine, host
```

- **Does:** Adds host dimension.
    
- **Use for:** Identify which machines executed which commands.
    

15. DCSync hunt (Security log)

```
index="main" EventCode=4662 Access_Mask=0x100 Account_Name!=*$
```

- **Does:** Finds AD object access with Control Access by users (not machine accts).
    
- **Use for:** Detecting likely DCSync attempts.
    

16. LSASS handle access (Sysmon EID 10)

```
index="main" EventCode=10 lsass | stats count by SourceImage
```

- **Does:** Who opened handles to lsass.exe.
    
- **Use for:** Credential-dumping detection leads; sort by count to spot outliers.
    

17. Zoom on odd sources (example: notepad)

```
index="main" EventCode=10 lsass SourceImage="C:\\Windows\\System32\\notepad.exe"
```

- **Does:** Shows details of suspicious access.
    
- **Use for:** Confirm unusual process behavior against LSASS.
    

18. Scope UNKNOWN call stacks (build an alert seed)

```
index="main" CallTrace="*UNKNOWN*" | stats count by EventCode
```

- **Does:** Which event types show UNKNOWN in call stacks.
    
- **Use for:** Decide where to focus (often EventCode=10).
    

19. Group UNKNOWN by source process

```
index="main" CallTrace="*UNKNOWN*" | stats count by SourceImage
```

- **Does:** Tallies by process.
    
- **Use for:** See who’s making “unbacked memory” calls (possible shellcode).
    

20. Remove trivial self-access

```
index="main" CallTrace="*UNKNOWN*" | where SourceImage!=TargetImage | stats count by SourceImage
```

- **Does:** Excludes self-handles.
    
- **Use for:** Reduce noise.
    

21. Exclude .NET / JIT noise

```
index="main" CallTrace="*UNKNOWN*" SourceImage!="*Microsoft.NET*" CallTrace!=*ni.dll* CallTrace!=*clr.dll* 
| where SourceImage!=TargetImage | stats count by SourceImage
```

- **Does:** Filters common JIT false positives.
    
- **Use for:** Increase fidelity for UNKNOWN alerts.
    

22. Exclude WOW64 artifacts

```
index="main" CallTrace="*UNKNOWN*" SourceImage!="*Microsoft.NET*" CallTrace!=*ni.dll* CallTrace!=*clr.dll* CallTrace!=*wow64* 
| where SourceImage!=TargetImage | stats count by SourceImage
```

- **Does:** Removes frequent 32↔64 thunk noise.
    
- **Use for:** Cleaner candidate set.
    

23. Exclude Explorer (too chatty)

```
index="main" CallTrace="*UNKNOWN*" SourceImage!="*Microsoft.NET*" CallTrace!=*ni.dll* CallTrace!=*clr.dll* CallTrace!=*wow64*
SourceImage!="C:\\Windows\\Explorer.EXE" | where SourceImage!=TargetImage | stats count by SourceImage
```

- **Does:** Drops a high-variance, high-noise process.
    
- **Use for:** Raise signal for true malicious sources.
    

24. Enrich results for triage/alerting

```
index="main" CallTrace="*UNKNOWN*" SourceImage!="*Microsoft.NET*" CallTrace!=*ni.dll* 
CallTrace!=*clr.dll* CallTrace!=*wow64* SourceImage!="C:\\Windows\\Explorer.EXE" 
| where SourceImage!=TargetImage | stats count by SourceImage, TargetImage, CallTrace
```

- **Does:** Shows who touched whom and the stack.
    
- **Use for:** Triage evidence & final alert logic.
    

* * *

&nbsp;