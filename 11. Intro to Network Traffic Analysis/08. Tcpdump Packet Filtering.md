---
title: 08. Tcpdump Packet Filtering
updated: 2025-09-09 05:05:52Z
created: 2025-09-09 04:05:26Z
---

# Tcpdump Packet Filtering – In Depth

## 1\. Why Filters Matter

By default, `tcpdump` captures **everything** on an interface. On a busy network, this creates:

- **Huge files** (gigabytes of raw traffic).
    
- **Performance impact** (buffers filling, dropped packets).
    
- **Noise** (irrelevant data hiding what you’re looking for).
    

**Filters** let you:

- Narrow down capture scope.
    
- Target specific hosts, ports, or protocols.
    
- Reduce disk space and CPU usage.
    
- Focus analysis on suspicious or important traffic.
    

Filters are written using **Berkeley Packet Filter (BPF)** syntax. They apply **before tcpdump saves the packet**, so unwanted packets never enter the capture (unless applied later during analysis).

* * *

## 2\. Core Filter Types

Here’s a reference table with deeper explanations:

| Filter | Meaning | Example | Use Case |
| --- | --- | --- | --- |
| **host** | Captures packets to/from a host (bidirectional). | `tcpdump host 10.0.0.5` | See everything a server or client is sending/receiving. |
| **src/dst** | Restrict to **source** or **destination** IP/port/net. | `tcpdump src host 10.0.0.5` | Only traffic *from* a given host (ignore responses). |
| **net** | Captures entire subnet traffic (CIDR notation). | `tcpdump net 192.168.1.0/24` | Monitor a whole VLAN or segment. |
| **port** | Matches source or destination port. | `tcpdump port 443` | Inspect HTTPS traffic. |
| **portrange** | Matches a range of ports. | `tcpdump portrange 0-1024` | See "well-known" services (HTTP, DNS, FTP, etc.). |
| **proto** | Filters by protocol (TCP, UDP, ICMP, ARP, etc.). | `tcpdump icmp` or `tcpdump proto 1` | Focus on ping, DNS, etc. |
| **less / greater** | Filters by packet size in bytes. | `tcpdump greater 500` | Spot large transfers (file uploads, malware exfiltration). |
| **and / or / not** | Combine multiple conditions with logic. | `tcpdump host 10.0.0.5 and port 80` | Get only web traffic to a host. |

* * *

## 3\. Operator Power – Combining Filters

Tcpdump allows **Boolean logic**:

- `and` (`&&`) → must meet *both* conditions.
    
- `or` (`||`) → must meet *either* condition.
    
- `not` (`!`) → exclude packets.
    

Example:

`tcpdump src host 192.168.1.10 and not port 22`

Captures all traffic from `192.168.1.10` except SSH.

* * *

## 4\. Pre-Capture vs. Post-Capture Filtering

- **Pre-Capture**: applied during live capture (`tcpdump -i eth0 host 10.0.0.5`).
    
    - Pros: smaller pcap, less resource usage.
        
    - Cons: packets not matching the filter are **lost forever**.
        
- **Post-Capture**: applied on saved files (`tcpdump -r file.pcap host 10.0.0.5`).
    
    - Pros: you still have full raw data.
        
    - Cons: big files, slower analysis.
        

**Tip**: Use pre-capture filters when troubleshooting a specific issue. Use post-capture filters in forensics to avoid losing evidence.

* * *

## 5\. Practical Examples

### Host Filtering

`tcpdump -i eth0 host 172.16.146.2`

See all conversations involving that IP (both src and dst).

### Source/Destination

`tcpdump -i eth0 src host 10.0.0.5`

`tcpdump -i eth0 dst net 192.168.0.0/16`

- First command: only traffic **from** `10.0.0.5`.
    
- Second command: only traffic going **into** the `192.168.x.x` network.
    

### Protocol Filtering

`tcpdump udp`

`tcpdump proto 1 (same as "icmp")`

Match by protocol name or number.

### Port Filtering

`tcpdump tcp port 443`

`tcpdump udp port 53`

`tcpdump portrange 20-25`

Great for focusing on HTTPS, DNS, or a suspicious service range.

### Size Filtering

`tcpdump greater 1000`

`tcpdump less 64`

- `greater 1000` → large packets (maybe file transfer).
    
- `less 64` → handshake/keepalive packets.
    

### Combining

`tcpdump host 192.168.0.1 and port 23`

`tcpdump icmp or arp`

`tcpdump not tcp`

* * *

## 6\. Advanced Filters (Header Offsets)

Tcpdump allows inspecting **packet headers at byte level**:

- Syntax: `proto[offset] & mask != value`.
    
- Example:
    
- `tcpdump 'tcp[13] & 2 != 0'`
    
    - `tcp[13]` → 13th byte in TCP header (flags field).
        
    - `& 2` → bitmask for SYN flag.
        
    - `!= 0` → show packets where SYN is set.
        

You can filter for:

- `tcp[13] & 1 != 0` → FIN.
    
- `tcp[13] & 16 != 0` → ACK.
    
- `tcp[13] & 4 != 0` → RST.
    

This is **powerful for detecting scans** (SYN floods, half-open connections).

* * *

## 7\. Useful Output Modifiers

Tcpdump has display switches to make analysis easier:

| Switch | Meaning | Example Use |
| --- | --- | --- |
| `-v, -vv, -vvv` | Increase verbosity (more header fields). | Show TTL, TOS, IDs. |
| `-X` | Show both ASCII & hex dump. | Inspect HTTP headers, payload. |
| `-A` | Show only ASCII payload. | Extract text (HTML, emails). |
| `-c <N>` | Capture N packets then stop. | Quick tests. |
| `-n` | Don’t resolve hostnames. | Faster, avoids DNS noise. |
| `-s <size>` | Snap length (default 262144). | `-s0` = full packets. |
| `-S` | Show absolute seq numbers. | Compare with logs, detect anomalies. |
| `-q` | Quiet output. | Cleaner summaries. |
| `-l` | Line-buffered output (for piping). | Send output to `grep`. |

Example:

`tcpdump -A -nn -s0 -c 100 port 80 | grep "User-Agent"`

Extract HTTP User-Agents from first 100 packets.

* * *

## 8\. Security & Forensics Use Cases

- **Detect scans**:  
    `tcpdump 'tcp[13] & 2 != 0'` → SYN floods.
    
- **Spot DNS tunneling**:  
    `tcpdump udp port 53 and greater 200` → DNS packets unusually large.
    
- **Find malware callbacks**:  
    `tcpdump host suspicious.com or port 4444` → Watch for C2 traffic.
    
- **Catch data exfiltration**:  
    `tcpdump greater 1000 and dst net not 192.168.0.0/16` → Large outbound packets leaving local net.
    
- **Investigate weird ports**:  
    `tcpdump portrange 10000-20000` → Unusual high ports in use.
    

* * *

## 9\. Tips & Best Practices

1.  **Always use `-n`** to avoid DNS lookups (can skew results).
    
2.  **Limit capture size** with `-c` or filters when troubleshooting.
    
3.  **Use `-s0`** to ensure full packet capture if payload is important.
    
4.  **Pipe to tools** like `grep`, `awk`, `strings` for fast searching.
    

- `tcpdump -A -l | grep "password"`
    
- **Rotate files** with `-w` and `-G` for long captures.
    

1.  `tcpdump -i eth0 -w capture-%H.pcap -G 3600`
    
    (splits into hourly files).
    

* * *

&nbsp;