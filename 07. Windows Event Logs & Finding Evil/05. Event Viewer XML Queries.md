---
title: 05. Event Viewer XML Queries
updated: 2025-08-18 14:28:22Z
created: 2025-08-13 14:07:16Z
---

## **1\. Basic Structure**

Every XML filter follows this pattern:

```xml
<QueryList>
  <Query Id="0" Path="Security">
    <Select Path="Security">YOUR FILTER HERE</Select>
  </Query>
</QueryList>


```

- `Path="Security"` ‚Üí The log source (could be `Application`, `System`, `Microsoft-Windows-Sysmon/Operational`, etc.).
    
- Inside `<Select>` is your **XPath** filter.
    
- **`<Query Id="0">`** ‚Üí This is just an identifier for the query.
    
    - The `Id` is **not** the Event ID you‚Äôre filtering for ‚Äî it‚Äôs just an internal label so Event Viewer can distinguish multiple queries.

* * *

## **2\. Common Queries**

### **Filter by Event ID**

`*[System[(EventID=4624)]]`

- Example: Successful logon events.

* * *

### **Multiple Event IDs**

`*[System[(EventID=4624 or EventID=4625)]]`

- Example: Successful and failed logons.

* * *

### **Event ID + Field Match**

`*[System[(EventID=4624)]] and *[EventData[Data[@Name='LogonType']='10']]`

- Example: Remote logons (type 10).

* * *

### **Multiple Conditions (AND)**

`*[System[(EventID=4624)]] and *[EventData[Data[@Name='TargetUserName']='Administrator']]`

- Example: Logon to Administrator account.

* * *

### **Multiple Conditions (OR)**

`*[System[(EventID=4720) or (EventID=4726)]]`

- Example: Account creation OR deletion.

* * *

### **Specific Account + IP**

`*[System[(EventID=4624)]] and *[EventData[ (Data[@Name='TargetUserName']='john.doe') and (Data[@Name='IpAddress']='192.168.1.50') ]]`

* * *

## **3\. Useful Event IDs for DFIR**

| Log Category | Event ID(s) | Event Name / Description |
| --- | --- | --- |
| **Windows System Logs** | 1074 | **System Shutdown/Restart** ‚Äì Records when and why the system was shut down or restarted. Unexpected events may indicate malware or unauthorized access. |
|     | 6005 | **Event Log Service Started** ‚Äì Marks when the Event Log Service starts, often during boot-up; useful for identifying system restarts. |
|     | 6006 | **Event Log Service Stopped** ‚Äì Seen when the system shuts down; unexpected occurrences may indicate tampering. |
|     | 6013 | **Windows Uptime** ‚Äì Occurs daily, showing system uptime in seconds. Short uptimes may signal unauthorized reboots. |
|     | 7040 | **Service Status Change** ‚Äì Indicates a change in service startup type (manual ‚Üî automatic). Could be a sign of tampering. |
| **Windows Security Logs** | 1102 | **Audit Log Cleared** ‚Äì Often an attempt to remove evidence of malicious activity. |
|     | 1116 | **Antivirus Malware Detection** ‚Äì Logs when Defender detects malware; a surge could mean an active attack. |
|     | 1118 | **Antivirus Remediation Started** ‚Äì Defender begins removing/quarantining malware. |
|     | 1119 | **Antivirus Remediation Succeeded** ‚Äì Confirms successful malware removal. |
|     | 1120 | **Antivirus Remediation Failed** ‚Äì Indicates remediation failure; needs immediate attention. |
|     | 4624 | **Successful Logon** ‚Äì Tracks successful logons; abnormal times or locations may indicate compromise. |
|     | 4625 | **Failed Logon** ‚Äì Tracks failed logons; multiple attempts may indicate brute-force attacks. |
|     | 4648 | **Logon with Explicit Credentials** ‚Äì May indicate lateral movement attempts. |
|     | 4656 | **Handle to Object Requested** ‚Äì Could signal access attempts to sensitive files/keys. |
|     | 4672 | **Special Privileges Assigned to New Logon** ‚Äì Indicates admin/superuser logon; important for privilege abuse monitoring. |
|     | 4698 | **Scheduled Task Created** ‚Äì Attackers often use this for persistence. |
|     | 4700, 4701 | **Scheduled Task Enabled/Disabled** ‚Äì May be used to control malicious persistence. |
|     | 4702 | **Scheduled Task Updated** ‚Äì Changes to existing tasks; could indicate tampering. |
|     | 4719 | **System Audit Policy Changed** ‚Äì Turning off or altering auditing could indicate an attempt to hide activity. |
|     | 4738 | **User Account Changed** ‚Äì Unexpected changes could mean account takeover. |
|     | 4771 | **Kerberos Pre-Authentication Failed** ‚Äì May indicate Kerberos brute-force attempts. |
|     | 4776 | **Domain Controller Credential Validation** ‚Äì Failed attempts could be brute-force attempts. |
|     | 5001 | **Antivirus Real-Time Protection Changed** ‚Äì Unauthorized changes may indicate an attempt to disable AV. |
|     | 5140 | **Network Share Accessed** ‚Äì Useful for detecting unauthorized data access. |
|     | 5142 | **Network Share Created** ‚Äì Could be used for data exfiltration or malware spread. |
|     | 5145 | **Network Share Access Check** ‚Äì Frequent checks may indicate reconnaissance. |
|     | 5157 | **Connection Blocked by Windows Filtering Platform** ‚Äì Helps detect malicious traffic. |
|     | 7045 | **Service Installed** ‚Äì Unknown services may indicate malware installation. |

* * *

## **4.Query Examples**

&nbsp;

## **1\. Brute-Force Logon Attempts (Failed Logons)**

```xml
<QueryList>
  <Query Id="0" Path="Security">
    <Select Path="Security">
      *[System[(EventID=4625)]]
    </Select>
  </Query>
</QueryList>

```

üí° **Tip:** Sort by "Account Name" or "Source Network Address" to spot repeated attempts.

* * *

## **2\. Successful RDP Logons**

(Logon Type 10 = Remote Interactive)

```xml
<QueryList>
  <Query Id="0" Path="Security">
    <Select Path="Security">
      *[System[(EventID=4624)]]
        and
      *[EventData[Data[@Name='LogonType']='10']]
    </Select>
  </Query>
</QueryList>

```

* * *

## **3\. Privilege Escalation Detection**

(Event 4672 = Special privileges assigned to a new logon)

```xml
<QueryList>
  <Query Id="0" Path="Security">
    <Select Path="Security">
      *[System[(EventID=4672)]]
    </Select>
  </Query>
</QueryList>

```

* * *

## **4\. New User Account Created**

(Event 4720)

```xml
<QueryList>
  <Query Id="0" Path="Security">
    <Select Path="Security">
      *[System[(EventID=4720)]]
    </Select>
  </Query>
</QueryList>

```

* * *

## **5\. User Added to Administrators Group**

(Event 4732 + group.name: Administrators)

```xml
<QueryList>
  <Query Id="0" Path="Security">
    <Select Path="Security">
      *[System[(EventID=4732)]]
        and
      *[EventData[Data[@Name='TargetUserName']='Administrators']]
    </Select>
  </Query>
</QueryList>

```

* * *

## **6\. File Share Access**

(Event 5140 = Share access, 5145 = Detailed access)

```xml
<QueryList>
  <Query Id="0" Path="Security">
    <Select Path="Security">
      *[System[(EventID=5140 or EventID=5145)]]
    </Select>
  </Query>
</QueryList>

```

* * *

## **7\. Service Creation (Possible Persistence)**

(Event 7045 in System log)

```xml
<QueryList>
  <Query Id="0" Path="System">
    <Select Path="System">
      *[System[(EventID=7045)]]
    </Select>
  </Query>
</QueryList>

```

* * *

## **8\. Detect Logons with Explicit Credentials**

(Event 4648 = `runas` or remote credential usage)

```xml
<QueryList>
  <Query Id="0" Path="Security">
    <Select Path="Security">
      *[System[(EventID=4648)]]
    </Select>
  </Query>
</QueryList>

```

* * *

## **How to Use**

1.  Open **Event Viewer**
    
2.  Navigate to the log (Security/System/etc.)
    
3.  Click **Filter Current Log‚Ä¶**
    
4.  Go to **XML tab ‚Üí Check ‚ÄúEdit query manually‚Äù**
    
5.  Paste query ‚Üí **OK**
    

* * *

&nbsp;