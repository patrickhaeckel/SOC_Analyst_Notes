---
title: 04. Get-WinEvent
updated: 2025-08-17 23:16:45Z
created: 2025-08-15 00:57:21Z
---

### **Mass Analysis of Windows Event Logs with PowerShell**

In cybersecurity, especially during **Incident Response (IR)** and **threat hunting**, analyzing Windows Event Logs and Sysmon logs is crucial. These logs provide detailed information about:

- System health and state
    
- User activity
    
- Security events and alerts
    
- System changes and configurations
    
- Troubleshooting errors
    

However, in large organizations, these logs can become **massive**, generating millions of entries per day. This is where efficient analysis tools become essential.

* * *

### **Get-WinEvent Cmdlet**

The **`Get-WinEvent`** cmdlet in PowerShell is a powerful tool for querying Windows Event Logs at scale. Unlike the older `Get-EventLog` cmdlet, `Get-WinEvent` can:

- Query **classic event logs** (like System, Application, Security)
    
- Access **Windows Event Log (WEL) channels**
    
- Read **Event Tracing for Windows (ETW)** logs
    

This makes it ideal for large-scale log analysis.

* * *

### **Listing Available Logs**

To see which logs are available on your system, use the `-ListLog` parameter:

`Get-WinEvent -ListLog *`

This retrieves **all available logs**. To display key properties of each log, you can pipe the results to `Select-Object`:

`Get-WinEvent -ListLog | Select-Object`

Example:

`Get-WinEvent -ListLog * | Select-Object LogName, RecordCount, IsClassicLog, IsEnabled, LogMode, LogType`

**Explanation of the properties:**

| Property | Description |
| --- | --- |
| **LogName** | The name of the log (e.g., System, Application) |
| **RecordCount** | Number of entries in the log |
| **IsClassicLog** | True if it’s a legacy log (older event log format) |
| **IsEnabled** | True if the log is currently recording events |
| **LogMode** | The retention mode of the log (Circular, AutoBackup, etc.) |
| **LogType** | The type of log (Admin, Operational, Analytical, Debug) |

**Tip:** The pipe `|` operator in PowerShell passes the output of one command to another. Here, it passes the raw log list to `Select-Object` to **filter and display only the most relevant properties**.

&nbsp;

# Retrieving Specific Event Logs with `Get-WinEvent`

The `Get-WinEvent` cmdlet is a powerful way to retrieve and filter Windows event logs. It works with both **live event logs** (on local or remote systems) and **exported `.evtx` files**.

## 1\. Basic Retrieval

The simplest usage is to pull events directly from a log (e.g., **System log**):

```ps
Get-WinEvent -LogName 'System' -MaxEvents 50 | 
Select-Object TimeCreated, Id, ProviderName, LevelDisplayName, Message | 
Format-Table -AutoSize
```

**What happens here**:

- `-LogName 'System'` → specify which log.
    
- `-MaxEvents 50` → retrieve the 50 most recent events.
    
- `Select-Object ...` → choose useful columns.
    
- `Format-Table` → make it readable.
    

This makes large event logs easier to scan and analyze.

* * *

## 2\. Targeting Specific Logs

Windows stores events in many specialized logs. For example, **WinRM events** are kept in a dedicated log:

```ps
Get-WinEvent -LogName 'Microsoft-Windows-WinRM/Operational' -MaxEvents 30 | 
Select-Object TimeCreated, Id, ProviderName, LevelDisplayName, Message | 
Format-Table -AutoSize
```

Same structure, but now targeting the **WinRM/Operational** log.

### Getting the *oldest* events

Normally, Get-WinEvent returns the **newest events first**. Use `-Oldest` to reverse this:

```ps
Get-WinEvent -LogName 'Microsoft-Windows-WinRM/Operational' -Oldest -MaxEvents 30
```

* * *

## 3\. Reading Exported Logs (`.evtx` Files)

You don’t have to query a live system — you can analyze saved logs with `-Path`:

```ps
Get-WinEvent -Path 'C:\Tools\pcalua.evtx' -MaxEvents 5 | 
Select-Object TimeCreated, Id, ProviderName, LevelDisplayName, Message | 
Format-Table -AutoSize
```

Useful for **incident response** (import logs from another machine) or **offline auditing**.

* * *

## 4\. Filtering with `FilterHashtable`

Instead of grabbing *everything*, filter by conditions (e.g., event ID, date range):

### By Event ID

```ps
Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Sysmon/Operational'; ID=1,3}
```

- ID `1` → Process Creation
    
- ID `3` → Network Connection
    

### By Date Range

```ps
$startDate = Get-Date "2023-05-28"$endDate = Get-Date "2023-06-03"Get-WinEvent 
-FilterHashtable @{ LogName='Microsoft-Windows-Sysmon/Operational' ID=1,3 StartTime=$startDate EndTime=$endDate}
```

⏳ Note: EndDate is **exclusive**, so `06/03` actually stops at `06/02 23:59:59`.

### On Exported Files

```ps
Get-WinEvent -FilterHashtable @{Path='C:\Logs\sysmon.evtx'; ID=1,3}
```

* * *

## 5\. Advanced Filtering (XML & XPath)

Some data isn’t exposed as top-level properties — you need to parse the XML.

### Example: Extracting Network Connections (Sysmon ID 3)

```ps
Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Sysmon/Operational'; ID=3} |
ForEach-Object {
    $xml = [xml]$_.ToXml()
    $eventData = $xml.Event.EventData.Data
    [PSCustomObject]@{
        SourceIP      = ($eventData | Where-Object {$_.Name -eq "SourceIp"}).'#text'
        DestinationIP = ($eventData | Where-Object {$_.Name -eq "DestinationIp"}).'#text'
        ProcessGuid   = ($eventData | Where-Object {$_.Name -eq "ProcessGuid"}).'#text'
        ProcessId     = ($eventData | Where-Object {$_.Name -eq "ProcessId"}).'#text'
    }
} | Where-Object {$_.DestinationIP -eq "52.113.194.132"}

```

This extracts only connections to a **suspicious IP**.

* * *

### XML Query (FilterXml)

Look for DLL load events (Sysmon ID 7) involving `.NET` libraries:

```ps
$Query = @"
<QueryList>
  <Query Id="0">
    <Select Path="Microsoft-Windows-Sysmon/Operational">
      *[System[(EventID=7)]] and (*[EventData[Data='mscoree.dll']] or *[EventData[Data='clr.dll']])
    </Select>
  </Query>
</QueryList>
"@

Get-WinEvent -FilterXml $Query

```

* * *

### XPath Filtering

XPath lets you query directly within event XML:

```ps
Get-WinEvent -LogName 'Microsoft-Windows-Sysmon/Operational' 
-FilterXPath "*[System[EventID=3] and EventData[Data[@Name='DestinationIp']='52.113.193.133']]"

```

Directly finds Sysmon network connection events to a **suspicious IP**.

&nbsp;

## Filtering with **Properties** (`Select-Object`, `.Properties[]`)

- **What it does**: Retrieves an event and lets you dig into the **array of values** Sysmon stores inside it.
    
- **Why use it**: When you need quick property-based searches (instead of full XML queries).
    

### Example: Show all fields of one event

```ps
Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Sysmon/Operational'; ID=1} -MaxEvents 1 ` | 
Select-Object -Property *
```

- This dumps everything: message, process path, hashes, parent process, etc.  
    It shows you **which property index maps to which field** (e.g., `.Properties[21]` = `ParentCommandLine`).

* * *

### Example: Look for suspicious parent command lines (`-enc`)

```ps
Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Sysmon/Operational'; ID=1} ` | 
Where-Object { $_.Properties[21].Value -like "*-enc*" } ` |
Format-List
```

**Breakdown**:

- `-FilterHashtable @{LogName=...; ID=1}` → only Sysmon **process creation** events.
    
- `Where-Object { $_.Properties[21].Value -like "*-enc*" }`
    
    - `$_` → current event in the pipeline.
        
    - `.Properties[21].Value` → parent process command line.
        
    - `-like "*-enc*"` → check if `-enc` appears anywhere (often a sign of obfuscated PowerShell).
        
- `Format-List` → display all details clearly.
    

* * *